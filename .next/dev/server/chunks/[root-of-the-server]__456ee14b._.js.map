{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/kirti.krishnan/Desktop/Projects/RTAA/rtaa/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\n\nif (!supabaseUrl) {\n  throw new Error('Missing NEXT_PUBLIC_SUPABASE_URL in environment');\n}\nif (!supabaseServiceRoleKey) {\n  throw new Error('Missing SUPABASE_SERVICE_ROLE_KEY in environment');\n}\n\n// Custom fetch with better error handling for Node.js and corporate proxies\nconst customFetch: typeof fetch = async (input, init) => {\n  try {\n    // For development: bypass SSL verification for corporate proxies\n    // In Node.js 20+, we need to handle self-signed certificates\n    const https = await import('https');\n    const agent = new https.Agent({\n      rejectUnauthorized: false, // Accept self-signed certificates\n    });\n\n    const response = await fetch(input, {\n      ...init,\n      // @ts-ignore - agent is valid for Node.js fetch\n      agent,\n      // @ts-ignore - keepalive may not be in types but is valid\n      keepalive: false,\n    });\n    return response;\n  } catch (error) {\n    console.error('Supabase fetch error:', error);\n    throw error;\n  }\n};\n\nexport const supabase = createClient(supabaseUrl, supabaseServiceRoleKey, {\n  auth: { persistSession: false },\n  global: {\n    headers: { 'x-rt-agent-assist': 'rtaa-demo' },\n    fetch: customFetch,\n  },\n});\n\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAEpE;;AAGA,IAAI,CAAC,wBAAwB;IAC3B,MAAM,IAAI,MAAM;AAClB;AAEA,4EAA4E;AAC5E,MAAM,cAA4B,OAAO,OAAO;IAC9C,IAAI;QACF,iEAAiE;QACjE,6DAA6D;QAC7D,MAAM,QAAQ;QACd,MAAM,QAAQ,IAAI,MAAM,KAAK,CAAC;YAC5B,oBAAoB;QACtB;QAEA,MAAM,WAAW,MAAM,MAAM,OAAO;YAClC,GAAG,IAAI;YACP,gDAAgD;YAChD;YACA,0DAA0D;YAC1D,WAAW;QACb;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM;IACR;AACF;AAEO,MAAM,WAAW,IAAA,yMAAY,EAAC,aAAa,wBAAwB;IACxE,MAAM;QAAE,gBAAgB;IAAM;IAC9B,QAAQ;QACN,SAAS;YAAE,qBAAqB;QAAY;QAC5C,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///Users/kirti.krishnan/Desktop/Projects/RTAA/rtaa/app/api/calls/intent/route.ts"],"sourcesContent":["/**\n * Intent API Routes\n * GET - Retrieve latest intent for a call\n * POST - Store detected intent\n */\n\nimport { NextResponse } from 'next/server';\nimport { supabase } from '@/lib/supabase';\n\ninterface IntentRequest {\n  callId: string;\n  seq: number;\n  intent: string;\n  confidence: number;\n}\n\n/**\n * GET /api/calls/intent?callId=...\n * Returns the most recent intent for a call\n */\nexport async function GET(req: Request) {\n  try {\n    const url = new URL(req.url);\n    const callId = url.searchParams.get('callId');\n\n    if (!callId) {\n      return NextResponse.json(\n        { ok: false, error: 'Missing callId parameter' },\n        { status: 400 }\n      );\n    }\n\n    console.info('[intent-api] Fetching latest intent for callId:', callId);\n\n    // Get the most recent intent for this call\n    const { data, error } = await supabase\n      .from('intents')\n      .select('intent, confidence, created_at, seq')\n      .eq('call_id', callId)\n      .order('seq', { ascending: false })\n      .limit(1);\n\n    if (error) {\n      console.error('[intent-api] Supabase error:', error);\n      return NextResponse.json(\n        { ok: false, error: 'Failed to fetch intent' },\n        { status: 500 }\n      );\n    }\n\n    if (!data || data.length === 0) {\n      return NextResponse.json(\n        { ok: false, error: 'No intent found for this call' },\n        { status: 404 }\n      );\n    }\n\n    const latest = data[0];\n\n    return NextResponse.json({\n      ok: true,\n      intent: latest.intent,\n      confidence: latest.confidence,\n      seq: latest.seq,\n      created_at: latest.created_at,\n    });\n  } catch (err: any) {\n    console.error('[intent-api] Error:', err);\n    return NextResponse.json(\n      { ok: false, error: err.message || String(err) },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * POST /api/calls/intent\n * Stores a detected intent\n */\nexport async function POST(req: Request) {\n  try {\n    const body: IntentRequest = await req.json();\n\n    // Validate required fields\n    if (!body.callId || body.seq === undefined || !body.intent || body.confidence === undefined) {\n      return NextResponse.json(\n        { ok: false, error: 'Missing required fields: callId, seq, intent, confidence' },\n        { status: 400 }\n      );\n    }\n\n    console.info('[intent-api] Storing intent:', {\n      callId: body.callId,\n      seq: body.seq,\n      intent: body.intent,\n      confidence: body.confidence,\n    });\n\n    // Insert into Supabase\n    const { data, error } = await supabase\n      .from('intents')\n      .insert({\n        call_id: body.callId,\n        seq: body.seq,\n        intent: body.intent,\n        confidence: body.confidence,\n        created_at: new Date().toISOString(),\n      })\n      .select();\n\n    if (error) {\n      console.error('[intent-api] Supabase insert error:', error);\n      // Don't fail the request, just log it\n      return NextResponse.json({\n        ok: true,\n        warning: 'Intent stored in memory but Supabase insert failed',\n        error: error.message,\n      });\n    }\n\n    console.info('[intent-api] Intent stored successfully:', data);\n\n    return NextResponse.json({\n      ok: true,\n      intent: body.intent,\n      confidence: body.confidence,\n    });\n  } catch (err: any) {\n    console.error('[intent-api] Error:', err);\n    return NextResponse.json(\n      { ok: false, error: err.message || String(err) },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}